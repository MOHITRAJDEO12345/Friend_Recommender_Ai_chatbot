main.py

import os
from PIL import Image
import streamlit as st
from streamlit_option_menu import option_menu
from gemini_utility import load_gemini_pro_model, get_stylist_response
from db_utils import init_db, verify_user, save_user, save_preferences, get_preferences

# Initialize database
init_db()

# Page configuration
st.set_page_config(
    page_title="AI Personal Stylist",
    page_icon="ðŸ‘”",
    layout="centered",
)
# Sidebar navigation
with st.sidebar:
    selected = option_menu('AI Personal Stylist',
                          ['Login',
                           'Style Preferences',
                           'Style Assistant'],
                          menu_icon='person-circle', 
                          icons=['key-fill', 'sliders', 'chat-dots-fill'],
                          default_index=0
                          )
with st.sidebar:
    st.markdown('<h2>ðŸ¤– Chatbot</h2>', unsafe_allow_html=True)
    st.markdown('<p>Ask me for personalized fashion advice!</p>', unsafe_allow_html=True)

# Initialize session states
if "username" not in st.session_state:
    st.session_state.username = None
if "chat_session" not in st.session_state:
    st.session_state.chat_session = None

# Login Page
if selected == "Login":
    st.title("ðŸ‘‹ Welcome to AI Personal Stylist")
    
    username = st.text_input("Username")
    password = st.text_input("Password", type="password")
    col1, col2 = st.columns(2)
    
    with col1:
        if st.button("Login"):
            if verify_user(username, password):
                st.session_state.username = username
                st.success("Logged in successfully!")
            else:
                st.error("Invalid credentials")
    
    with col2:
        if st.button("Register"):
            save_user(username, password)
            st.success("Registration successful!")

# Style Preferences Page
elif selected == "Style Preferences":
    if not st.session_state.username:
        st.warning("Please login first")
    else:
        st.title("ðŸŽ¨ Your Style Preferences")
        
        # Load existing preferences
        existing_prefs = get_preferences(st.session_state.username)
        
        # Personal Information
        st.subheader("Personal Information")
        age = st.number_input("Age", 18, 100, 
                             value=existing_prefs['age'] if existing_prefs else 18)
        gender = st.selectbox("Gender", 
                            ["Male", "Female", "Non-binary"],
                            index=["Male", "Female", "Non-binary"].index(existing_prefs['gender']) 
                            if existing_prefs and existing_prefs['gender'] else 0)
        
        # Image Upload
        st.subheader("Your Photo")
        uploaded_image = st.file_uploader("Upload a full-length photo", type=["jpg", "jpeg", "png"])
        if uploaded_image:
            st.image(uploaded_image, width=300)
            image_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), 
                                    f"uploads/{st.session_state.username}_photo.jpg")
            # Convert image to RGB before saving
            image = Image.open(uploaded_image)
            if image.mode in ("RGBA", "P"):
                image = image.convert("RGB")
            image.save(image_path)
        
        # Style Preferences
        st.subheader("Style Preferences")
        style_preferences = st.multiselect(
            "Preferred Style Categories",
            ["Casual", "Formal", "Bohemian", "Minimalist", "Streetwear"],
            default=existing_prefs['style_preferences'] if existing_prefs else []
        )
        
        favorite_colors = st.multiselect(
            "Favorite Colors",
            ["Black", "White", "Blue", "Red", "Green", "Yellow", "Purple", "Pink"],
            default=existing_prefs['favorite_colors'] if existing_prefs else []
        )
        
        if st.button("Save Preferences"):
            preferences = {
                "age": age,
                "gender": gender,
                "style_preferences": style_preferences,
                "favorite_colors": favorite_colors
            }
            save_preferences(st.session_state.username, preferences, 
                           image_path if uploaded_image else None)
            st.success("Preferences saved successfully!")

# Style Assistant Chat
elif selected == "Style Assistant":
    if not st.session_state.username:
        st.warning("Please login first")
    else:
        st.title("ðŸ‘” Your Personal Style Assistant")
        
        # Get user preferences for context
        user_prefs = get_preferences(st.session_state.username)
        
        # Initialize chat
        if st.session_state.chat_session is None:
            model = load_gemini_pro_model()
            st.session_state.chat_session = model.start_chat(history=[])
        
        # Chat interface
        for message in st.session_state.chat_session.history:
            with st.chat_message("assistant" if message.role == "model" else "user"):
                st.markdown(message.parts[0].text)
        
        user_prompt = st.chat_input("Ask your style question...")
        
        if user_prompt:
            st.chat_message("user").markdown(user_prompt)
            
            # Create personalized context
            context = f"""As a personal stylist, consider these preferences:
            - Age: {user_prefs['age']}
            - Gender: {user_prefs['gender']}
            - Style preferences: {', '.join(user_prefs['style_preferences'])}
            - Favorite colors: {', '.join(user_prefs['favorite_colors'])}
            
            Question: {user_prompt}"""
            
            # Check if an image is provided in preferences
            image_path = user_prefs.get('image_path')
            if image_path and os.path.exists(image_path):
                image = Image.open(image_path)
                response = get_stylist_response(context, image)
            else:
                response = get_stylist_response(context)
            
            st.chat_message("assistant").markdown(response)




gemini_utility.py

import os
import json
from PIL import Image

import google.generativeai as genai

# working directory path
working_dir = os.path.dirname(os.path.abspath(__file__))

# path of config_data file
config_file_path = f"{working_dir}/config.json"
config_data = json.load(open("config.json"))

# loading the GOOGLE_API_KEY
GOOGLE_API_KEY = config_data["GOOGLE_API_KEY"]

# configuring google.generativeai with API key
genai.configure(api_key=GOOGLE_API_KEY)


def load_gemini_pro_model():
    gemini_pro_model = genai.GenerativeModel("gemini-2.0-flash")
    return gemini_pro_model

def get_stylist_response(prompt, image=None):
    base_prompt = "As a personal fashion stylist, "
    full_prompt = base_prompt + prompt
    
    if image:
        model = genai.GenerativeModel("gemini-2.0-flash")
        response = model.generate_content([full_prompt, image])
    else:
        model = genai.GenerativeModel("gemini-2.0-flash")
        response = model.generate_content(full_prompt)
    
    return response.text


# get response from Gemini-Pro-Vision model - image/text to text
def gemini_pro_vision_response(prompt, image):
    gemini_pro_vision_model = genai.GenerativeModel("gemini-2.0-flash")
    response = gemini_pro_vision_model.generate_content([prompt, image])
    result = response.text
    return result


# get response from embeddings model - text to embeddings
def embeddings_model_response(input_text):
    embedding_model = "models/embedding-001"
    embedding = genai.embed_content(model=embedding_model,
                                    content=input_text,
                                    task_type="retrieval_document")
    embedding_list = embedding["embedding"]
    return embedding_list


# get response from Gemini-Pro model - text to text
def gemini_pro_response(user_prompt):
    gemini_pro_model = genai.GenerativeModel("gemini-2.0-flash")
    response = gemini_pro_model.generate_content(user_prompt)
    result = response.text
    return result



db_utils.py

import sqlite3
import os

DB_PATH = os.path.join(os.path.dirname(os.path.abspath(__file__)), 'stylist.db')

def init_db():
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute('''CREATE TABLE IF NOT EXISTS users
                 (username TEXT PRIMARY KEY, password TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS preferences
                 (username TEXT PRIMARY KEY,
                  age INTEGER,
                  gender TEXT,
                  style_preferences TEXT,
                  favorite_colors TEXT,
                  image_path TEXT)''')
    conn.commit()
    conn.close()

def verify_user(username, password):
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute('SELECT * FROM users WHERE username=? AND password=?', (username, password))
    result = c.fetchone()
    conn.close()
    return bool(result)

def save_user(username, password):
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute('INSERT OR REPLACE INTO users VALUES (?, ?)', (username, password))
    conn.commit()
    conn.close()

def save_preferences(username, preferences, image_path=None):
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute('INSERT OR REPLACE INTO preferences VALUES (?, ?, ?, ?, ?, ?)',
              (username, preferences['age'], preferences['gender'],
               ','.join(preferences['style_preferences']),
               ','.join(preferences['favorite_colors']),
               image_path))
    conn.commit()
    conn.close()

def get_preferences(username):
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute('SELECT * FROM preferences WHERE username=?', (username,))
    result = c.fetchone()
    conn.close()
    
    if result:
        return {
            'age': result[1],
            'gender': result[2],
            'style_preferences': result[3].split(',') if result[3] else [],
            'favorite_colors': result[4].split(',') if result[4] else [],
            'image_path': result[5]
        }
    return None


requirements.txt
google-generativeai
pillow
streamlit
streamlit-option-menu
streamlit-authenticator
pyyaml


readme.md
# Personal Stylist Chatbot

## Overview

The Personal Stylist Chatbot is an AI-driven application designed to provide personalized fashion advice. It leverages advanced generative AI models to offer style recommendations based on user preferences and uploaded images.

## Features

- **User Authentication**: Secure login and registration system to manage user accounts.
- **Style Preferences**: Users can set and save their style preferences, including age, gender, preferred style categories, and favorite colors.
- **Image Upload**: Users can upload a full-length photo to receive more personalized style advice.
- **AI Style Assistant**: An interactive chat interface where users can ask style-related questions and receive tailored advice.
- **Database Management**: Utilizes SQLite for storing user credentials and preferences.

## Technologies Used

- **Streamlit**: For building the web application interface.
- **Google Generative AI**: To generate fashion advice and recommendations.
- **SQLite**: For database management.
- **Pillow**: For image processing.

## Project Structure

- **main.py**: The main application file that sets up the Streamlit interface and handles user interactions.
- **gemini_utility.py**: Contains utility functions for interacting with the generative AI models.
- **db_utils.py**: Manages database operations such as user verification and preference storage.
- **config.json**: Stores configuration data, including API keys.
- **requirements.txt**: Lists the Python dependencies required for the project.

## Usage

1. Launch the application using Streamlit.
2. Register or log in to access the features.
3. Set your style preferences and upload a photo if desired.
4. Use the Style Assistant to ask questions and receive personalized fashion advice.

## Note

This project is intended for educational and personal use. Ensure that you have the necessary API keys and permissions to use the generative AI services.


